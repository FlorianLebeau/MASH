<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MASH — ENTRE2</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:24px;max-width:860px}
    .card{padding:16px;border:1px solid #ddd;border-radius:14px;margin:12px 0}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .pill{display:inline-block;padding:6px 10px;border:1px solid #ddd;border-radius:999px}
    .muted{opacity:.7}
    input[type="range"]{width:100%}
    .rangeWrap{position:relative}
    
.sliderBox{
  position:relative;
  height:56px;
  margin-top:12px;
}

.track{
  position:absolute;
  left:0; right:0;
  top:26px;
  height:6px;
  border-radius:999px;
  background:#e6e6e6;
}

.range{
  position:absolute;
  top:26px;
  height:6px;
  border-radius:999px;
  background:#111; /* tu peux changer */
  left:0%;
  right:0%;
}

.thumb{
  pointer-events:none; /* on réactive sur le thumb via pseudo elements */
  position:absolute;
  left:0; right:0;
  top:14px;
  width:100%;
  height:32px;
  margin:0;
  background:transparent;
  -webkit-appearance:none;
  appearance:none;
}

.thumb::-webkit-slider-runnable-track{ height:6px; background:transparent; }
.thumb::-moz-range-track{ height:6px; background:transparent; }

.thumb::-webkit-slider-thumb{
  pointer-events:auto;
  -webkit-appearance:none;
  appearance:none;
  height:20px;
  width:20px;
  border-radius:50%;
  border:2px solid #111;
  background:#fff;
  cursor:pointer;
  margin-top:-7px; /* aligne le thumb sur la track */
}

.thumb::-moz-range-thumb{
  pointer-events:auto;
  height:20px;
  width:20px;
  border-radius:50%;
  border:2px solid #111;
  background:#fff;
  cursor:pointer;
}

/* Petits crans */
.ticks{
  position:absolute;
  left:0; right:0;
  top:2px;
  height:18px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  pointer-events:none;
}

.tick{
  position:relative;
  width:1px;
  height:10px;
  background:#777;
  opacity:.9;
}

.tickLabel{
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  font-size:11px;
  opacity:.7;
  white-space:nowrap;
}
  </style>
</head>
<body>
  <h1>ENTRE2</h1>

  <div class="row">
    <span class="pill" id="scalePill">scale: -</span>
    <span class="pill" id="unitPill">unit: -</span>
  </div>

  <div class="card">
    <div id="aff" style="font-weight:800;font-size:18px;">Chargement…</div>
    <div class="muted" id="qid" style="margin-top:6px;"></div>
  </div>

<div class="card">
  <div style="font-weight:700;margin-bottom:10px;">Choisis ton intervalle</div>

  <div class="sliderBox">
    <div class="ticks" id="ticksBar"></div>

    <div class="track"></div>
    <div class="range" id="rangeFill"></div>

    <!-- 2 sliders superposés -->
    <input id="minR" class="thumb thumb--left" type="range" />
    <input id="maxR" class="thumb thumb--right" type="range" />
  </div>

  <div class="row" style="margin-top:12px;">
    <span class="pill" id="intervalPill">intervalle: -</span>
  </div>
</div>

  <p class="muted" id="status"></p>

  
<script>
  const BASE = "https://script.google.com/macros/s/AKfycbxkzjXgoGlb456tMCTwF4TLdtwdYpBUHZuN5ZEDoOP4Sg4CtNrV1-9Tnv4KSj1o0UR6/exec"; // .../exec

const aff = document.getElementById("aff");
  const qid = document.getElementById("qid");
  const scalePill = document.getElementById("scalePill");
  const unitPill = document.getElementById("unitPill");
  const intervalPill = document.getElementById("intervalPill");
  const statusEl = document.getElementById("status");

  const minR = document.getElementById("minR");
  const maxR = document.getElementById("maxR");
  const rangeFill = document.getElementById("rangeFill");
  const ticksBar = document.getElementById("ticksBar");

  let unit = "";
  let cfg = null;

  function configForScaleGroup(g) {
    if (g === 1) return { min: 1, max: 10, step: 1 };
    if (g === 2) return { min: 10, max: 100, step: 10 };
    if (g === 3) return { min: 100, max: 1000, step: 100 };
    return { min: 1, max: 10, step: 1 };
  }

  function buildTicks({min,max,step}) {
    const out = [];
    for (let v = min; v <= max; v += step) out.push(v);
    return out;
  }

  function setSliders({min,max,step}) {
    [minR, maxR].forEach(r => {
      r.min = min;
      r.max = max;
      r.step = step;
    });

    // ✅ initial: extrémités
    minR.value = min;
    maxR.value = max;
  }

  function clampAndSync(which) {
    let a = Number(minR.value);
    let b = Number(maxR.value);

    // Empêche l’inversion
    if (a > b) {
      if (which === "min") b = a;
      else a = b;
      minR.value = a;
      maxR.value = b;
    }

    // Remplissage visuel (en %)
    const min = Number(minR.min);
    const max = Number(minR.max);
    const leftPct = ((a - min) / (max - min)) * 100;
    const rightPct = 100 - ((b - min) / (max - min)) * 100;

    rangeFill.style.left = `${leftPct}%`;
    rangeFill.style.right = `${rightPct}%`;

    intervalPill.textContent = `intervalle: ${a} – ${b} ${unit}`.trim();
  }

  function renderTicks(cfg) {
    const ticks = buildTicks(cfg);

    ticksBar.innerHTML = "";
    ticks.forEach((t, idx) => {
      const tick = document.createElement("div");
      tick.className = "tick";

      // Labels: pour ne pas surcharger, on labelise extrémités + milieu
      const showLabel = (idx === 0) || (idx === ticks.length - 1) || (idx === Math.floor(ticks.length / 2));
      if (showLabel) {
        const lab = document.createElement("div");
        lab.className = "tickLabel";
        lab.textContent = String(t);
        tick.appendChild(lab);
      }
      ticksBar.appendChild(tick);
    });
  }

  minR.addEventListener("input", () => clampAndSync("min"));
  maxR.addEventListener("input", () => clampAndSync("max"));

  async function loadQuestion() {
    statusEl.textContent = "Chargement de la question…";

    const url = `${BASE}?action=entre2_question`;
    const res = await fetch(url);
    const data = await res.json();

    if (!data.ok) {
      statusEl.textContent = `Erreur: ${data.error}`;
      return;
    }

    aff.textContent = data.affirmation;
    qid.textContent = `qId: ${data.qId}`;

    unit = data.unitGroup || "";
    unitPill.textContent = `unit: ${unit || "-"}`;

    const sg = Number(data.scaleGroup || 1);
    scalePill.textContent = `scale: ${sg}`;

    cfg = configForScaleGroup(sg);
    renderTicks(cfg);
    setSliders(cfg);
    clampAndSync("min");

    statusEl.textContent = "Prêt ✅";
  }

  loadQuestion();

  async function loadQuestion() {
    statusEl.textContent = "Chargement de la question…";

    const url = `${BASE}?action=entre2_question`;
    const res = await fetch(url);
    const data = await res.json();

    if (!data.ok) {
      statusEl.textContent = `Erreur: ${data.error}`;
      return;
    }

    aff.textContent = data.affirmation;
    qid.textContent = `qId: ${data.qId}`;
    unit = data.unitGroup || "";
    unitPill.textContent = `unit: ${unit || "-"}`;

    const sg = Number(data.scaleGroup || 1);
    scalePill.textContent = `scale: ${sg}`;

    cfg = configForScaleGroup(sg);
    const ticks = buildTicks(cfg);
    ticksEl.textContent = `Crans: ${ticks.join(" · ")}`;

    setSliders(cfg);
    sync();

    statusEl.textContent = "Prêt ✅";
  }

  loadQuestion();
</script>
</body>
</html>
