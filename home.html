<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MASH — Home</title>
<style>
body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:24px;max-width:720px}
.card{padding:16px;border:1px solid #ddd;border-radius:14px;margin:12px 0}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
button{
  padding:10px 14px;
  border-radius:12px;
  border:1px solid #ddd;
  background:#fff;
  cursor:pointer;
}
button:hover{background:#f5f5f5}
.pill{display:inline-block;padding:6px 10px;border:1px solid #ddd;border-radius:999px}
.muted{opacity:.6}
</style>
</head>

<body>

<h1>MASH</h1>

<div class="card">
  <div style="font-weight:700;margin-bottom:10px;">Session</div>
  <div class="row">
    <input id="sessionInput" placeholder="Session ID (ex: Alpha2)" />
    <button id="saveSessionBtn">Valider</button>
  </div>
  <div class="muted" id="sessionInfo"></div>
</div>

<div class="card">
  <div style="font-weight:700;margin-bottom:10px;">Jeux disponibles</div>
  <div id="gamesList" class="row"></div>
</div>

<div class="card">
  <div style="font-weight:700;margin-bottom:10px;">Classements</div>
  <button id="resultsBtn">Voir les classements</button>
</div>

<script>

const BASE = "https://script.google.com/macros/s/AKfycbxkzjXgoGlb456tMCTwF4TLdtwdYpBUHZuN5ZEDoOP4Sg4CtNrV1-9Tnv4KSj1o0UR6/exec";

const sessionInput = document.getElementById("sessionInput");
const saveSessionBtn = document.getElementById("saveSessionBtn");
const sessionInfo = document.getElementById("sessionInfo");
const gamesList = document.getElementById("gamesList");
const resultsBtn = document.getElementById("resultsBtn");

let sessionId = localStorage.getItem("mash_sessionId") || "";

if (sessionId) {
  sessionInput.value = sessionId;
  sessionInfo.textContent = `Session active: ${sessionId}`;
  loadGames();
}

saveSessionBtn.addEventListener("click", () => {
  sessionId = sessionInput.value.trim();
  if (!sessionId) return;
  localStorage.setItem("mash_sessionId", sessionId);
  sessionInfo.textContent = `Session active: ${sessionId}`;
  loadGames();
});

async function loadGames() {
  gamesList.innerHTML = "";
  if (!sessionId) return;

  const url = `${BASE}?action=list_games&session=${encodeURIComponent(sessionId)}`;

  try {
    const res = await fetch(url);
    const data = await res.json();
    if (!data.ok) {
      gamesList.innerHTML = `<span class="muted">${data.error}</span>`;
      return;
    }

    data.games.forEach(g => {
      const btn = document.createElement("button");
      btn.textContent = g;
      btn.onclick = () => {
        window.location.href = `${g}.html`;
      };
      gamesList.appendChild(btn);
    });

  } catch(e) {
    gamesList.innerHTML = `<span class="muted">Erreur chargement jeux</span>`;
  }
}

resultsBtn.addEventListener("click", () => {
  if (!sessionId) {
    alert("Sélectionne une session d'abord.");
    return;
  }
  window.location.href = "results.html";
});

</script>
</body>
</html>


